---
title: "Intermediate SQL Tutorial Notes"
output: html_document
---

# Intermediate SQL Tutorial Notes

# SQL COUNT

## Write a query to count the number of non-null rows in the low column.

```{sql}
SELECT COUNT(low) AS count_low
  FROM tutorial.aapl_historical_stock_price
```

## Write a query that determines counts of every single column. Which column has the most null values?

```{sql}
SELECT COUNT(date) AS count_date,
       COUNT(year) AS count_year,
       COUNT(month) AS count_month,
       COUNT(open) AS count_open,
       COUNT(high) AS count_high,
       COUNT(low) AS count_low,
       COUNT(close) AS count_close,
       COUNT(volume) AS count_volume,
       COUNT(id) AS count_id
  FROM tutorial.aapl_historical_stock_price

-- column high has the most null values
```

# SQL SUM

## Write a query to calculate the average opening price (hint: you will need to use both COUNT and SUM, as well as some simple arithmetic.).

```{sql}
SELECT SUM(open) / COUNT(open) AS avg_open
  FROM tutorial.aapl_historical_stock_price
```

# SQL MIN/MAX

## What was Apple's lowest stock price (at the time of this data collection)?

```{sql}
SELECT MIN(low) AS min_low
  FROM tutorial.aapl_historical_stock_price
```

## What was the highest single-day increase in Apple's share value?

```{sql}
SELECT MAX(close - open) AS max_increase
  FROM tutorial.aapl_historical_stock_price
```

# SQL AVG

## Write a query that calculates the average daily trade volume for Apple stock.

```{sql}
SELECT AVG(volume) AS avg_volume
  FROM tutorial.aapl_historical_stock_price
```

# SQL GROUP BY

## Calculate the total number of shares traded each month. Order your results chronologically.

```{sql}
SELECT year,
       month,
       SUM(volume) AS num_shares
  FROM tutorial.aapl_historical_stock_price
  GROUP BY year, month
  ORDER BY year, month
```

## Write a query to calculate the average daily price change in Apple stock, grouped by year.

```{sql}
SELECT year,
       AVG(close - open) AS avg_price_change
  FROM tutorial.aapl_historical_stock_price
  GROUP BY year
  ORDER BY year

```

## Write a query that calculates the lowest and highest prices that Apple stock achieved each month.

```{sql}
SELECT year,
       month,
       MIN(low) AS lowest_monthy_price,
       MAX(high) AS highest_monthy_price
  FROM tutorial.aapl_historical_stock_price
  GROUP BY year, month
  ORDER BY year, month
```

# SQL HAVING

```{sql}
SELECT year,
       month,
       MAX(high) AS month_high
  FROM tutorial.aapl_historical_stock_price
 GROUP BY year, month
HAVING MAX(high) > 400
 ORDER BY year, month
```

If you wanted to filter the year or month, you could add the condition to the HAVING using AND, or use a WHERE clause as well:

```{sql}
SELECT year,
       month,
       MAX(high) AS month_high
  FROM tutorial.aapl_historical_stock_price
 GROUP BY year, month
HAVING MAX(high) > 400 AND month > 8
 ORDER BY year, month
```

```{sql}
SELECT year,
       month,
       MAX(high) AS month_high
  FROM tutorial.aapl_historical_stock_price
  WHERE month > 8
 GROUP BY year, month
HAVING MAX(high) > 400
 ORDER BY year, month
```

Order must be:

1. SELECT
2. FROM
3. WHERE
4. GROUP BY
5. HAVING
6. ORDER BY

# SQL CASE

## Write a query that includes a column that is flagged "yes" when a player is from California, and sort the results with those players first.

```{sql}
SELECT player_name,
       state,
       CASE WHEN state = 'CA' THEN 'yes'
       ELSE 'no' END AS is_in_california
  FROM benn.college_football_players
  ORDER BY is_in_california DESC
```

```{sql}

```

```{sql}

```

```{sql}

```

```{sql}

```

```{sql}

```

```{sql}

```

```{sql}

```

```{sql}

```

